name: 'Deploy to fly'
description: 'Deploys a published image to fly'
inputs:
  image:
    required: true
    description: "Which image to deploy"
  config:
    required: true
    description: "Path to a fly.toml file"
  token:
    required: true
    description: "Access token for flyctl"

runs:
  using: 'composite'
  steps:
    - name: Deploy flyctl
      shell: bash
      run: |
        docker run \
          --rm \
          -v ${{ inputs.config }}:/workspace/fly.toml \
          --workdir /workspace \
          ghcr.io/superfly/flyctl:latest \
          deploy \
            -t ${{ inputs.token }} \
            -c /workspace/fly.toml \
            -i ${{ inputs.image }} \
            --yes \
            --verbose
